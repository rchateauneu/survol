# Big Thank You to https://github.com/cclauss/Travis-CI-Python-on-three-OSes/blob/master/.travis.yml
language: python            # this works for Linux but is an error on macOS or Windows
matrix:
  include:
    - name: "Python 2.7 Linux"
      os: linux
      python: 2.7
      addons:
        apt:
          packages:
            - graphviz
      before_install:
        - pip install supervisor # Optional, needed for events generators.
        - pip install demangler pyelftools
    - name: "Python 3.6 Linux"
      os: linux
      python: 3.6
      addons:
        apt:
          packages:
            - graphviz
      before_install:
        - pip install supervisor  # Optional, needed for events generators.
        - pip install demangler pyelftools
    - name: "Python 3.7.5 on Windows"
      os: windows           # Windows 10.0.17134 N/A Build 17134
      language: shell       # 'language: python' is an error on Travis CI Windows
      # python: 3.7         # 'python:' is ignored on Travis CI Windows
      before_install:
        # https://travis-ci.community/t/windows-python-pip-module-not-found/5480/4
        ##- choco install python  --version 3.7.5
        ##- python -m ensurepip
        # Suddenly: "python -m pip install --upgrade pip" failed and exited with 1 during"
        # No module named pip
        ### - python -m pip install --upgrade pip
        # This seems to run on Linux.
        - echo "In before_install"
        - choco install python  --version 3.7.5
        # /c/Users/travis/build/rchateauneu/survol
        - pwd
        # /c/ProgramData/chocolatey/bin/python
        - which python
        - dir `which python`
        # Python 2.7.9
        - python -V
        #- which python3
        #- python -m ensurepip
        #- choco install pip
        #- pip install pytest
        #- python -m pip install pytest
        #- python -m pip install --upgrade pip
        #- python -m pip install pytest         # Optional
        #- python -m pip install pefile         # Optional
        #- python -m pip install wmi            # Optional
        #- python -m pip install pywin32        # Optional
        #- python -m pip install pyodbc         # Optional
        #- python -m pip install supervisor-win # Optional, needed for events generators.
      install:
        # Is it possible to have an install step specific to a platform ?
        - echo "In install"
        - which python
        - python -V
        - powershell python -V
        #
        ##### - choco list --local-only
        # Chocolatey v0.10.15
        #Python 2.7.9
        #Python 2.7.9
        #Python 2.7.9
        #7zip.install 19.0
        #chocolatey 0.10.15
        #chocolatey-core.extension 1.3.5.1
        #chocolatey-dotnetfx.extension 1.0.1
        #chocolatey-fastanswers.extension 0.0.2
        #chocolatey-visualstudio.extension 1.8.1
        #chocolatey-windowsupdate.extension 1.0.4
        #cmake.install 3.17.3
        #curl 7.70.0
        #DotNet4.5.2 4.5.2.20140902
        #DotNet4.6 4.6.00081.20150925
        #DotNet4.6-TargetPack 4.6.00081.20150925
        #DotNet4.6.1 4.6.01055.20170308
        #dotnetfx 4.8.0.20190930
        #git.install 2.27.0
        #hashdeep 4.4
        #jq 1.6
        #KB2919355 1.0.20160915
        #KB2919442 1.0.20160915
        #KB2999226 1.0.20181019
        #KB3033929 1.0.5
        #KB3035131 1.0.3
        #llvm 10.0.0
        #microsoft-build-tools 15.0.26320.2
        #mingw 8.1.0
        #netfx-4.5.1-devpack 4.5.50932
        #netfx-4.5.2-devpack 4.5.5165101.20180721
        #netfx-4.6.1-devpack 4.6.01055.00
        #python 3.7.5
        #python3 3.7.5
        #rsync 5.5.0.20190204
        #ruby 2.7.1.1
        #vcredist140 14.26.28720.3
        #vcredist2017 14.16.27033
        #visualstudio-installer 2.0.1
        #visualstudio2017-workload-netcorebuildtools 1.1.2
        #visualstudio2017-workload-vctools 1.3.2
        #visualstudio2017-workload-webbuildtools 1.3.2
        #visualstudio2017buildtools 15.9.23.0
        #Wget 1.20.3.20190531
        #windows-sdk-10.1 10.1.18362.1
        #winscp 5.17.6
        #winscp.install 5.17.6
        #wsl 1.0.1
        ##### - choco list
        #
        # https://kendaleiv.com/using-sql-server-localdb-with-travis-ci-windows-builds/
        # Travis CI now includes support for Windows builds.
        # It doesn’t have SQL Server LocalDB installed by default currently, but it’s easy to install.
        # More explanations about
        # https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/sql-server-express-localdb
        # Here’s an example Travis CI configuration that installs it using Chocolatey:
        #
        # Use mssqlserver2014-sqllocaldb rather than sqllocaldb package which has an issue:
        # https://dba.stackexchange.com/questions/191393/localdb-v14-creates-wrong-path-for-mdf-files
        #
        # TODO: Must be tested.
        #
        # https://community.chocolatey.org/packages?q=SqlServer
        #
        # OK: choco install mssqlserver2014-sqllocaldb
        # "was not successful. Exit code was '-2146233079'": choco install sql-server-express -y
        # No output has been received in the last 10m0s
        # - choco install sqlserver2014express
        #- powershell -Command "Set-ExecutionPolicy Bypass"
        #- choco install sqlserver2014express -v -y
        #
        # Many various attempts:
        ##- choco install sqlserver-odbcdriver
        #
        # The install of mssqlserver-compact4.0 was NOT successful.
        #### - choco install mssqlserver-compact4.0
        #
        # The remote file either doesn't exist, is unauthorized, or is forbidden for url
        ####- choco install sqlserverlocaldb
        #
        # Does not work:
        # - choco install sqlserverexpress
        #
        ##- choco install sql-server-express
        # choco install sqlserver2008r2express-engine
        # - choco install sqlserver2012express-engine # sqlserver2012express-engine was NOT successful
        - choco install MsSqlServer2014Express
        # - choco install SqlServer2008R2Express
        # - choco install mssqlexpress2014sp1wt
        #
        # Maybe should do that, to investigate error cause: type C:\ProgramData\chocolatey\logs\chocolatey.log
        #
        # The install of sqlserver2008r2express was NOT successful.
        #- choco install sqlserver2008r2express
        #
        #- choco install mssql2014express-defaultinstance
        #- choco install sqlserver2008r2express-engine
        #- choco install sqlserver2014express
        #- choco install mssqlserver2012expressadv
        #- choco install mssqlserver2014-sqllocaldb
        #
        # Cannot find any service with service name 'MSSQL'
        ### powershell Start-Service 'MSSQL$SQLEXPRESS'
        #
        # unexpected EOF while looking for matching
        ### powershell Start-Service MSSQL BACK-TICK $SQLEXPRESS
        #
        # Cannot find any service with service name 'MSSQL\'
        ### powershell Start-Service 'MSSQL\$SQLEXPRESS'
        #
        # Cannot find any service with service name 'MSSQL'
        ### powershell Start-Service MSSQL\$SQLEXPRESS
        #
        # Cannot find any service with service name 'MSSQL1912SQLEXPRESS'
        ### powershell Start-Service MSSQL$$SQLEXPRESS
        #
        # Cannot find any service with service name 'MSSQL\'
        ### - powershell Start-Service MSSQL\\\$SQLEXPRESS
        #
        # Cannot find any service with service name 'MSSQL'
        ### - powershell Start-Service "MSSQL$SQLEXPRESS"
        #
        # Cannot find any service with service name 'MSSQL\\'
        # powershell Start-Service 'MSSQL\\$SQLEXPRESS'
        #
        # Start-Service : Cannot find any service with service name 'MSSQL$SQLEXPRESS'.
        #
        #At line:1 char:1
        #
        #+ Start-Service MSSQL`$SQLEXPRESS
        #
        #+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        #
        #    + CategoryInfo          : ObjectNotFound: (MSSQL$SQLEXPRESS:String) [Start-Service], ServiceCommandException
        #
        #    + FullyQualifiedErrorId : NoServiceFoundForGivenName,Microsoft.PowerShell.Commands.StartServiceCommand
        #### powershell Start-Service 'MSSQL`$SQLEXPRESS'
        #
        # Start-Service : Cannot find any service with service name 'SQLEXPRESS'.
        #
        #At line:1 char:1
        #
        #+ Start-Service SQLEXPRESS
        #
        #+ ~~~~~~~~~~~~~~~~~~~~~~~~
        #
        #    + CategoryInfo          : ObjectNotFound: (SQLEXPRESS:String) [Start-Service], ServiceCommandException
        #
        #    + FullyQualifiedErrorId : NoServiceFoundForGivenName,Microsoft.PowerShell.Commands.StartServiceCommand
        ### powershell Start-Service SQLEXPRESS
        #
        #
        # List of services
        - powershell Get-Service
        #
        #
        #      env:
        - PATH=/c/Python37:/c/Python37/Scripts:$PATH
      script:
        - echo "In script"
        - python -V
        - powershell python -V
        #
        - python -m pip install --upgrade pip
        # Specific to Windows.
        - pip install pytest
        - pip install pefile         # Optional
        - pip install wmi            # Optional
        - pip install pywin32        # Optional
        - pip install pyodbc         # Optional
        - pip install supervisor-win # Optional, needed for events generators.
        #
        # For all platforms.
        - pip install psutil               # Mandatory
        - pip install rdflib               # Mandatory
        - pip install SQLAlchemy==1.3.23   # 1.4 does not work with rdflib-sqlalchemy:0.4.0
        - pip install rdflib-sqlalchemy    # Optional, needed for events generators.
        - pip install SPARQLWrapper        # Optional
        - pip install pywbem               # Optional
        - pip install sqlparse             # Optional
        - pip install natsort              # Optional, needed for nicer sorts.
        - pip install twisted              # Optional
        #
        # Do it elsewhere than Linux.
        - pytest -v --durations=30 tests
        #
      #services:
      #  # https://docs:travis-ci.com/user/database-setup/
      #  #- MSSQLServer
      #  #- SQLEXPRESS
      #  - MSSQL$SQLEXPRESS

install:
  # TODO: For all platforms but overriden by Windows configuration.
  - pip install psutil               # Mandatory
  - pip install rdflib               # Mandatory
  - pip install SQLAlchemy==1.3.23   # 1.4 does not work with rdflib-sqlalchemy:0.4.0
  - pip install rdflib-sqlalchemy    # Optional, needed for events generators.
  - pip install SPARQLWrapper        # Optional
  - pip install pywbem               # Optional
  - pip install sqlparse             # Optional
  - pip install natsort              # Optional, needed for nicer sorts.
  - pip install twisted              # Optional
script:
  - pytest -v --durations=30 tests

